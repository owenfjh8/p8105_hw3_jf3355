---
title: "p8105_hw3_jf3355"
author: "Jiahao Fan"
date: "10/19/2021"
output: github_document
---

```{r}
library(p8105.datasets)
library(tidyverse)
library(lubridate)

data("instacart")
```


```{r}
#description of data
#There are 15 variables in this dataset:

#order_id: order identifier
#product_id: product identifier
#add_to_cart_order: order in which each product was added to cart
#reordered: 1 if this prodcut has been ordered by this user in the past, 0 otherwise
#user_id: customer identifier
#eval_set: which evaluation set this order belongs in (Note that the data for use in this class is exclusively from the “train” eval_set)
#order_number: the order sequence number for this user (1=first, n=nth)
#order_dow: the day of the week on which the order was placed
#order_hour_of_day: the hour of the day on which the order was placed
#days_since_prior_order: days since the last order, capped at 30, NA if order_number=1
#product_name: name of the product
#aisle_id: aisle identifier
#department_id: department identifier
#aisle: the name of the aisle
#department: the name of the department
```

The dataset has `r nrow(instacart)` observations and `r ncol(instacart)` columns. There are some key variable such as product_name: name of the product,aisle: the name of the aisle. 

How many aisles are there, and which aisles are the most items ordered from?
```{r}
num_aisle = 
  instacart %>%
  select(aisle)%>%
  n_distinct()
```
There is `r num_aisle` aisles.

```{r}
instacart %>%
  count(aisle) %>%
  arrange(desc(n),1)
```
From the table, we can see the most items ordered is fresh vegetables.

#make the plot
```{r}
instacart %>%
  count(aisle) %>%
  rename(count=n)%>%
  filter(count > 10000)%>%
  mutate(
    aisle = factor(aisle),
    aisle = forcats::fct_reorder(aisle, count)
  )%>%
  ggplot(aes(x= count, y= aisle))+ geom_bar(stat = "identity")+ labs(
    title = "Number of items odered in aisle",
    x = "Number of order",
    y = "Aisle"
  )
```

#make the table
```{r}
most_popular_item_df = 
  instacart %>%
  filter(aisle == "baking ingredients"|
         aisle == "dog food care"|
         aisle == "packaged vegetables fruits")%>%
  group_by(aisle)%>%
  count(product_name)%>%
  rename(ordered_times = n)%>%
  mutate(rank = min_rank(desc(ordered_times)))%>%
  filter(rank < 4)%>%
  arrange(aisle, rank)
knitr::kable(most_popular_item_df)
```

#make another table
```{r}
mean_hour_df = 
  instacart %>%
  filter(
         product_name == "Pink Lady Apples"|
         product_name == "Coffee Ice Cream") %>%
  group_by(product_name,order_dow)%>%
  summarize(mean_hour = mean(order_hour_of_day))%>%
  pivot_wider(names_from = "order_dow", values_from = "mean_hour")%>%
  rename("Sunday" = "0", 
         "Monday" = "1", 
         "Tuesday" = "2", 
         "Wednesday" = "3",
         "Thursday" = "4",
         "Friday" = "5",
         "Saturday" = "6")
           
knitr::kable(mean_hour_df)
```
Pro
